var linq2indexedDB,enableLogging=!0; (function(){function a(a,b){linq2indexedDB.prototype.core.db(b.name).then(function(b){var d=b[0];a.name=d.name;a.version=d.version;a.ObjectStores=[];linq2indexedDB.prototype.core.dbStructureChanged.addListener(linq2indexedDB.prototype.core.databaseEvents.databaseBlocked,function(){d.close()});for(var b=[],f=0;f<d.objectStoreNames.length;f++)b.push(d.objectStoreNames[f]);0<b.length&&linq2indexedDB.prototype.core.transaction(d,b,linq2indexedDB.prototype.core.transactionTypes.READ_ONLY,!1).then(null, null,function(b){for(var b=b[0],o=0;o<d.objectStoreNames.length;o++)linq2indexedDB.prototype.core.objectStore(b,d.objectStoreNames[o]).then(function(b){for(var b=b[1],d=[],o=[],f=0;f<b.indexNames.length;f++)linq2indexedDB.prototype.core.index(b,b.indexNames[f],!1).then(function(a){var a=a[1],b=[];linq2indexedDB.prototype.core.cursor(a).then(null,null,function(a){b.push({key:a[1].primaryKey,data:a[0]})});d.push({name:a.name,keyPath:a.keyPath,multiEntry:a.multiEntry,data:b})});linq2indexedDB.prototype.core.cursor(b).then(null, null,function(a){o.push({key:a[1].primaryKey,data:a[0]})});a.ObjectStores.push({name:b.name,keyPath:b.keyPath,autoIncrement:b.autoIncrement,indexes:d,data:o})})})},null,function(a){"upgradeneeded"==a[1].type&&a[0].abort()})}function f(a,b,f,d){if(a.onupgradeneeded)a.onupgradeneeded(d,b,f);if(a.oninitializeversion||a.schema||a.definition)for(b+=1;b<=f;b++){if(a.schema)a.schema[b](d);if(a.definition){var j,q=b;j=a.definition;for(var p=null,v=0;v<j.length;v++)parseInt(j[v].version)==parseInt(q)&&(p= j[v]);if(j=p){q=d;try{if(j.objectStores)for(p=0;p<j.objectStores.length;p++){var t=j.objectStores[p];t.remove?linq2indexedDB.prototype.core.deleteObjectStore(q,t.name):linq2indexedDB.prototype.core.createObjectStore(q,t.name,t.objectStoreOptions)}if(j.indexes)for(p=0;p<j.indexes.length;p++){var u=j.indexes[p];u.remove?linq2indexedDB.prototype.core.deleteIndex(linq2indexedDB.prototype.core.objectStore(q,u.objectStoreName),u.propertyName):linq2indexedDB.prototype.core.createIndex(linq2indexedDB.prototype.core.objectStore(q, u.objectStoreName),u.propertyName,u.indexOptions)}if(j.defaultData)for(p=0;p<j.defaultData.length;p++){var m=j.defaultData[p];m.remove?linq2indexedDB.prototype.core.remove(linq2indexedDB.prototype.core.objectStore(q,m.objectStoreName),m.key):linq2indexedDB.prototype.core.insert(linq2indexedDB.prototype.core.objectStore(q,m.objectStoreName),m.data,m.key)}}catch(s){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"initialize version exception: ",s),linq2indexedDB.prototype.core.abortTransaction(q)}}}else if(a.oninitializeversion)a.oninitializeversion(d, b)}}linq2indexedDB=function(i,b,o){var d={autoGenerateAllowed:!0};i&&(d.name=i);if(b){b.version&&(d.version=b.version);if(b.schema){i=d.version||-1;for(key in b.schema)i=version>key?version:key;-1<version&&(d.autoGenerateAllowed=!1,d.version=i,d.schema=b.schema)}b.definition&&(d.autoGenerateAllowed=!1,d.definition=b.definition);b.onupgradeneeded&&(d.autoGenerateAllowed=!1,d.onupgradeneeded=b.onupgradeneeded);b.oninitializeversion&&(d.autoGenerateAllowed=!1,d.oninitializeversion=b.oninitializeversion)}var b= linq2indexedDB.prototype.utilities,i=linq2indexedDB.prototype.core,j=function(a,b,d,g,c){var l={},e;if(typeof c==="undefined")l.not=function(){return j(a,b,d,g,true)};if(typeof b==="function"){e={propertyName:b,isOrClause:g,isAndClause:d,isNotClause:typeof c==="undefined"?false:c,filter:linq2indexedDB.prototype.linq.createFilter("anonymous"+a.where.length,b,null)};return q(a,e)}if(typeof b==="string")for(var h in linq2indexedDB.prototype.linq.filters){e={propertyName:b,isOrClause:g,isAndClause:d, isNotClause:typeof c==="undefined"?false:c,filter:linq2indexedDB.prototype.linq.filters[h]};if(typeof linq2indexedDB.prototype.linq.filters[h].filter!=="function")throw"Linq2IndexedDB: a filter methods needs to be provided for the filter '"+h+"'";if(typeof linq2indexedDB.prototype.linq.filters[h].name==="undefined")throw"Linq2IndexedDB: a filter name needs to be provided for the filter '"+h+"'";l[linq2indexedDB.prototype.linq.filters[h].name]=linq2indexedDB.prototype.linq.filters[h].filter(q,a,e)}return l}, q=function(a,b){a.where.push(b);return{and:function(b){return j(a,b,true,false)},or:function(b){return j(a,b,false,true)},orderBy:function(b){return p(a,b,false)},orderByDesc:function(b){return p(a,b,true)},select:function(b){return v(a,b)},remove:function(){return u(a)},merge:function(b){return t(a,b)}}},p=function(a,b,d){a.sortClauses.push({propertyName:b,descending:d});return{orderBy:function(g){return p(a,g,false)},orderByDesc:function(g){return p(a,g,true)},select:function(g){return v(a,g)}}}, v=function(a,b){if(b){linq2indexedDB.prototype.utilities.isArray(b)||(b=[b]);for(var d=0;d<b.length;d++)a.select.push(b[d])}return linq2indexedDB.prototype.utilities.promiseWrapper(function(g){var c=[];m(a,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,s).then(function(){g.complete(c)},g.error,function(l){var l=l[0],e=a.select;if(e&&e.length>0){linq2indexedDB.prototype.utilities.isArray(e)||(e=[e]);for(var h={},b=0;b<e.length;b++)linq2indexedDB.prototype.utilities.setPropertyValue(h,e[b], linq2indexedDB.prototype.utilities.getPropertyValue(l,e[b]));l=h}c.push(l);g.progress(this,l)})})},t=function(a,b,d){a.merge.push({data:b,key:d});if(d)return m(a,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,function(c,g,e){var e=linq2indexedDB.prototype.core.objectStore(e,c.from),a=null;linq2indexedDB.prototype.core.cursor(e,IDBKeyRange.only(c.merge[0].key)).then(function(){},g.error,function(e){a=e[0];for(var b in c.merge[0].data)a[b]=c.merge[0].data[b];e[1].update(a);g.complete(this, a)},g.error)});var g=[];return linq2indexedDB.prototype.utilities.promiseWrapper(function(c){m(a,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,s).then(function(l){g.length>0?c.complete(this,g):m(a,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,function(e,h,b){linq2indexedDB.prototype.core.objectStore(b,e.from).then(function(e){for(var b=0;b<l.length;b++){var d=l[b],i;for(i in a.merge[0].data)d[i]=a.merge[0].data[i];linq2indexedDB.prototype.core.update(e[1],d).then(function(e){c.progress(this, e[0]);g.push(e[0]);g.length==l.length&&h.complete(this,g)},h.error)}},h.error)}).then(c.complete,c.error,c.progress)},null,function(l){if(l.length>1){var e=l[0],b;for(b in a.merge[0].data)e[b]=a.merge[0].data[b];l[1].update(e);c.progress(this,e);g.push(e)}})})},u=function(a,b){if(b){a.remove.push({key:b});return m(a,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,function(g,c,l){linq2indexedDB.prototype.core.remove(linq2indexedDB.prototype.core.objectStore(l,g.from),g.remove[0].key).then(function(){c.complete(this, a.remove[0].key)},c.error)})}var d=false;return linq2indexedDB.prototype.utilities.promiseWrapper(function(g){m(a,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,s).then(function(c){d?g.complete(this):m(a,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,function(l,e,a){linq2indexedDB.prototype.core.objectStore(a,l.from).then(function(l){for(var a=0,b=0;b<c.length;b++)linq2indexedDB.prototype.core.remove(l[1],linq2indexedDB.prototype.utilities.getPropertyValue(c[b],l[1].keyPath)).then(function(l){g.progress(this, l[0]);++a==c.length&&e.complete(this)},e.error)},e.error)}).then(g.complete,g.error,g.progress)},null,function(c){if(c.length>1){c[1]["delete"]();g.progress(this);d=true}})})},m=function(a,b,i){return linq2indexedDB.prototype.utilities.promiseWrapper(function(g){linq2indexedDB.prototype.core.db(d.name,d.version).then(function(c){linq2indexedDB.prototype.core.transaction(c[0],a.from,b,d.autoGenerateAllowed).then(function(c){c[0].db.close()},g.error,function(c){i(a,g,c[0])})},g.error,function(c){var g= c[0],c=c[1];c.type=="upgradeneeded"&&f(d,c.oldVersion,c.newVersion,g)})})},s=function(a,b,i){linq2indexedDB.prototype.core.objectStore(i,a.from).then(function(g){try{var c=a.where||[],l=[],e=g[1],h;if(c.length>0&&!c[0].isNotClause&&c[0].filter.indexeddbFilter&&(c.length==1||c.length>1&&!c[1].isOrClause)){var g=e,i=d.autoGenerateAllowed||e.indexNames.contains(c[0].propertyName+linq2indexedDB.prototype.core.indexSuffix);c[0].propertyName!=e.keyPath&&i&&(g=linq2indexedDB.prototype.core.index(e,c[0].propertyName, d.autoGenerateAllowed));if(c[0].propertyName==e.keyPath||i){var w=c.shift();switch(w.filter){case linq2indexedDB.prototype.linq.filters.equals:h=linq2indexedDB.prototype.core.cursor(g,IDBKeyRange.only(w.value));break;case linq2indexedDB.prototype.linq.filters.between:h=linq2indexedDB.prototype.core.cursor(g,IDBKeyRange.bound(w.minValue,w.maxValue,w.minValueIncluded,w.maxValueIncluded));break;case linq2indexedDB.prototype.linq.filters.greaterThan:h=linq2indexedDB.prototype.core.cursor(g,IDBKeyRange.lowerBound(w.value, w.valueIncluded));break;case linq2indexedDB.prototype.linq.filters.smallerThan:h=linq2indexedDB.prototype.core.cursor(g,IDBKeyRange.upperBound(w.value,w.valueIncluded));break;default:h=linq2indexedDB.prototype.core.cursor(g)}}else h=linq2indexedDB.prototype.core.cursor(g)}else h=linq2indexedDB.prototype.core.cursor(e);h.then(function(g){linq2indexedDB.prototype.utilities.linq2indexedDBWorker(g[0],c,a.sortClauses).then(function(c){if(l.length==0)for(var g=0;g<c.length;g++)b.progress(this,[c[g]]);b.complete(this, c)})},b.error,function(g){if(c.length==0&&a.sortClauses.length==0){l.push(g[0]);b.progress(this,g)}})}catch(f){linq2indexedDB.prototype.core.abortTransaction(args[0]);b.error(this,[f.message,f])}},b.error)},x=function(a){this.from=a;this.where=[];this.select=[];this.sortClauses=[];this.get=[];this.insert=[];this.merge=[];this.update=[];this.remove=[];this.clear=false};x.prototype={executeQuery:function(){m(this)}};b={utilities:b,core:i,linq:{from:function(a){var b=new x(a);b.from=a;return{where:function(a){return j(b, a,true,false)},orderBy:function(a){return p(b,a,false)},orderByDesc:function(a){return p(b,a,true)},select:function(a){return v(b,a)},insert:function(a,g){b.insert.push({data:a,key:g});return m(b,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,function(c,g,e){e=linq2indexedDB.prototype.core.objectStore(e,c.from);if(linq2indexedDB.prototype.utilities.isArray(c.insert[0].data)&&!c.insert[0].key)for(var a=[],b=0;b<c.insert[0].data.length;b++)linq2indexedDB.prototype.core.insert(e,c.insert[0].data[b]).then(function(e){g.progress(this, {object:e[0],key:e[1]});a.push({object:e[0],key:e[1]});a.length==c.insert[0].data.length&&g.complete(this,a)},g.error);else linq2indexedDB.prototype.core.insert(e,c.insert[0].data,c.insert[0].key).then(function(c){g.complete(this,{object:c[0],key:c[1]})},g.error)})},update:function(a,g){b.update.push({data:a,key:g});return m(b,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,function(c,g,e){linq2indexedDB.prototype.core.update(linq2indexedDB.prototype.core.objectStore(e,c.from),c.update[0].data, c.update[0].key).then(function(c){g.complete(this,{object:c[0],key:c[1]})},g.error)})},merge:function(a,g){return t(b,a,g)},remove:function(a){return u(b,a)},clear:function(){b.clear=true;return m(b,linq2indexedDB.prototype.core.transactionTypes.READ_WRITE,function(a,g,c){linq2indexedDB.prototype.core.clear(linq2indexedDB.prototype.core.objectStore(c,a.from)).then(function(){g.complete(this)},g.error)})},get:function(a){b.get.push({key:a});return m(b,linq2indexedDB.prototype.core.transactionTypes.READ_ONLY, function(g,c,a){linq2indexedDB.prototype.core.get(linq2indexedDB.prototype.core.objectStore(a,g.from),g.get[0].key).then(function(g){c.complete(this,g[0])},c.error)})}}}},initialize:function(){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Initialize Started");return linq2indexedDB.prototype.utilities.promiseWrapper(function(a){linq2indexedDB.prototype.core.db(d.name,d.version).then(function(b){b=b[0];linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Close dbconnection");b.close();linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Initialize Succesfull");a.complete()},a.error,function(a){var b=a[0],a=a[1];a.type=="upgradeneeded"&&f(d,a.oldVersion,a.newVersion,b)})})},deleteDatabase:function(){return linq2indexedDB.prototype.utilities.promiseWrapper(function(a){linq2indexedDB.prototype.core.deleteDb(d.name).then(function(){a.complete()},a.error)})}};if(o){var n={},r=!0;n.Configuration={name:d.name, version:d.version,autoGenerateAllowed:d.autoGenerateAllowed,schema:d.schema,definition:d.definition,onupgradeneeded:d.onupgradeneeded,oninitializeversion:d.oninitializeversion};n.refresh=function(){r=true;r=false;a(n,d)};linq2indexedDB.prototype.core.dbStructureChanged.addListener(linq2indexedDB.prototype.core.databaseEvents.databaseUpgrade,function(){r=true});linq2indexedDB.prototype.core.dbStructureChanged.addListener(linq2indexedDB.prototype.core.databaseEvents.databaseOpened,function(){if(r){r= false;a(n,d)}});linq2indexedDB.prototype.core.dbStructureChanged.addListener(linq2indexedDB.prototype.core.databaseEvents.databaseRemoved,function(){n.name=null;n.version=null;n.ObjectStores=[]});linq2indexedDB.prototype.core.dbDataChanged.addListener([linq2indexedDB.prototype.core.dataEvents.dataInserted,linq2indexedDB.prototype.core.dataEvents.dataRemoved,linq2indexedDB.prototype.core.dataEvents.dataUpdated,linq2indexedDB.prototype.core.dataEvents.objectStoreCleared],function(){n.refresh()});b.viewer= n;enableLogging=o}return b}})(); (function(){linq2indexedDB.prototype.linq={addFilter:function(a,f,i){if("undefined"!==typeof linq2indexedDB.prototype.linq.filters[a])throw"linq2IndexedDB: A filter with the name '"+a+"' already exists.";linq2indexedDB.prototype.linq.filters[a]=linq2indexedDB.prototype.linq.createFilter(a,f,i)},createFilter:function(a,f,i){if("undefined"===typeof a)throw"linq2IndexedDB: No name argument provided to the addFilter method.";if("string"!==typeof a)throw"linq2IndexedDB: The name argument provided to the addFilterObject method must be a string.";if("undefined"=== typeof f)throw"linq2IndexedDB: No isValid argument provided to the addFilter method.";if("function"!==typeof f)throw"linq2IndexedDB: The isValid argument provided to the addFilterObject method must be a function.";if("undefined"===typeof i)throw"linq2IndexedDB: No filterCallback argument provided to the addFilter method.";return{name:a,indexeddbFilter:!1,sortOrder:99,isValid:f,filter:i}},filters:{equals:{name:"equals",indexeddbFilter:!0,sortOrder:0,isValid:function(a,f){return linq2indexedDB.prototype.utilities.getPropertyValue(a, f.propertyName)==f.value},filter:function(a,f,i){return function(b){if(!b)throw"linq2indexedDB: value needs to be provided to the equal clause";i.value=b;return a(f,i)}}},between:{name:"between",sortOrder:1,indexeddbFilter:!0,isValid:function(a,f){var i=linq2indexedDB.prototype.utilities.getPropertyValue(a,f.propertyName);return(i>f.minValue||f.minValueIncluded&&i==f.minValue)&&(i<f.maxValue||f.maxValueIncluded&&i==f.maxValue)},filter:function(a,f,i){return function(b,o,d,j){if(!b)throw"linq2indexedDB: minValue needs to be provided to the between clause"; if(!o)throw"linq2indexedDB: maxValue needs to be provided to the between clause";i.minValue=b;i.maxValue=o;i.minValueIncluded=void 0===typeof d?!1:d;i.maxValueIncluded=void 0===typeof j?!1:j;return a(f,i)}}},greaterThan:{name:"greaterThan",sortOrder:2,indexeddbFilter:!0,isValid:function(a,f){var i=linq2indexedDB.prototype.utilities.getPropertyValue(a,f.propertyName);return i>f.value||f.valueIncluded&&i==f.value},filter:function(a,f,i){return function(b,o){if(!b)throw"linq2indexedDB: value needs to be provided to the greatherThan clause"; i.value=b;i.valueIncluded=void 0===typeof o?!1:o;return a(f,i)}}},smallerThan:{name:"smallerThan",sortOrder:2,indexeddbFilter:!0,isValid:function(a,f){var i=linq2indexedDB.prototype.utilities.getPropertyValue(a,f.propertyName);return i<f.value||f.valueIncluded&&i==f.value},filter:function(a,f,i){return function(b,o){if(!b)throw"linq2indexedDB: value needs to be provided to the smallerThan clause";i.value=b;i.valueIncluded=void 0===typeof o?!1:o;return a(f,i)}}},inArray:{name:"inArray",sortOrder:3, indexeddbFilter:!1,isValid:function(a,f){var i=linq2indexedDB.prototype.utilities.getPropertyValue(a,f.propertyName);return i?0<=f.value.indexOf(i):!1},filter:function(a,f,i){return function(b){if(!b&&"Array"!==typeof b)throw"linq2indexedDB: array needs to be provided to the inArray clause";i.value=b;return a(f,i)}}},like:{name:"like",sortOrder:4,indexeddbFilter:!1,isValid:function(a,f){var i=linq2indexedDB.prototype.utilities.getPropertyValue(a,f.propertyName);return i?0<=i.indexOf(f.value):!1}, filter:function(a,f,i){return function(b){if(!b)throw"linq2indexedDB: value needs to be provided to the like clause";i.value=b;return a(f,i)}}},isUndefined:{name:"isUndefined",sortOrder:5,indexeddbFilter:!1,isValid:function(a,f){return void 0===linq2indexedDB.prototype.utilities.getPropertyValue(a,f.propertyName)},filter:function(a,f,i){return function(){return a(f,i)}}}}}})(); (function(a){var f={linq2indexedDBWorkerFileLocation:"/Scripts/Linq2IndexedDB.js",linq2indexedDBWorker:function(a,b,o){return f.promiseWrapper(function(d){if(window.Worker){var j=new Worker(f.linq2indexedDBWorkerFileLocation);j.onmessage=function(a){d.complete(this,a.data)};j.onerror=d.error;var q=JSON.stringify(b,linq2indexedDB.prototype.utilities.serialize);j.postMessage({data:a,filters:q,sortClauses:o})}else d.complete(this,f.filterSort(a,b,o))})},isArray:function(a){return a instanceof Array? !0:!1},JSONComparer:function(a,b){return{sort:function(f,d){return b?f[a]==d[a]?0:f[a]>d[a]?-1:1:f[a]==d[a]?0:f[a]>d[a]?1:-1}}},promiseWrapper:function(i){if(a)return new WinJS.Promise(function(a,f,d){i({complete:function(d,i){a(i)},error:function(a,b){f(b)},progress:function(a,b){d(b)}})});if("function"===typeof $&&$.Deferred)return $.Deferred(function(a){i({complete:function(i,d){a.resolveWith(i,[d])},error:function(i,d){a.rejectWith(i,[d])},progress:function(i,d){a.notifyWith(i,[d])}})}).promise(); throw"linq2indexedDB: No framework (WinJS or jQuery) that supports promises found. Please ensure jQuery or WinJS is referenced before the linq2indexedDB.js file.";},log:function(){if(window&&"undefined"===typeof window.console||!enableLogging)return!1;var a=arguments[0],b=arguments,f;f=new Date;f=f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+"."+f.getMilliseconds();b[0]=f+" Linq2IndexedDB: ";arguments[1]+=" ";switch(a){case linq2indexedDB.prototype.utilities.severity.exception:window.console.exception? window.console.exception.apply(console,arguments):window.console.error.apply(console,arguments);break;case linq2indexedDB.prototype.utilities.severity.error:window.console.error.apply(console,arguments);break;case linq2indexedDB.prototype.utilities.severity.warning:window.console.warning.apply(console,arguments);break;case linq2indexedDB.prototype.utilities.severity.information:window.console.log.apply(console,arguments);break;default:window.console.log.apply(console,arguments)}return!0},filterSort:function(a, b,o){for(var d=[],j=0;j<a.length;j++)f.isDataValid(a[j],b)&&(d=f.addToSortedArray(d,a[j],o));return d},isDataValid:function(a,b){for(var f=!0,d=0;d<b.length;d++){var j=b[d].filter.isValid(a,b[d]);b[d].isNotClause&&(j=!j);b[d].isAndClause?f=f&&j:b[d].isOrClause&&(f=f||j)}return f},addToSortedArray:function(a,b,f){var d=[];if(0==a.length||0==f.length)d=a,d.push(b);else{for(var j=!1,q=0;q<a.length;q++)for(var p=a[q],v=b,t=0;t<f.length;t++){var u=linq2indexedDB.prototype.utilities.getPropertyValue(p, f[t].propertyName),m=linq2indexedDB.prototype.utilities.getPropertyValue(v,f[t].propertyName);if(u!=m){if(!(f[t].descending&&u>m||!f[t].descending&&u<m)&&!j)j=!0,d.push(v);d.push(p)}else t==f.length-1&&d.push(p)}j||d.push(b)}return d},serialize:function(a,b){return"function"===typeof b?b.toString():b},deserialize:function(a,b){if(b&&"string"===typeof b&&"function"==b.substr(0,8)){var f=b.indexOf("{")+1,d=b.lastIndexOf("}"),j=b.indexOf("(")+1,q=b.indexOf(")");return new Function(b.substring(j,q),b.substring(f, d))}return b},getPropertyValue:function(a,b){for(var f=b.split("."),d=a,j=0;j<f.length;j++)d&&(d=d[f[j]]);return d},setPropertyValue:function(a,b,f){for(var b=b.split("."),d=0;d<b.length;d++)d!=b.length-1?(a[b[d]]={},a=a[b[d]]):a[b[d]]=f;return a},severity:{information:0,warning:1,error:2,exception:3}};linq2indexedDB.prototype.utilities=f})("undefined"!==typeof Windows); "undefined"!==typeof window?(function(a,f){function i(){this._listeners={}}function b(g,c){return linq2indexedDB.prototype.utilities.promiseWrapper(function(a){try{g(a,c)}catch(e){e.type="exception",a.error(c,[e.message,e])}})}function o(g,c){c.onerror=function(a){g.error(c,[c.errorCode,a])}}function d(g,c){c.onabort=function(a){g.error(c,[c.errorCode,a])}}function j(g,c){c.onsuccess=function(a){g.complete(c,[c.result,a])};o(g,c)}function q(g,c){c.onsuccess=function(a){c.result?g.progress(c,[c.result, a]):g.complete(c,[c.result,a])};o(g,c)}function p(a,c){j(a,c);c.onblocked=function(l){a.progress(c,["blocked",l])}}function v(a,c){p(a,c);c.onupgradeneeded=function(l){a.progress(c,[c.transaction,l])}}function t(a,c){d(a,c);o(a,c);c.onversionchange=function(l){a.progress(c,[c.result,l])}}function u(a,c){c.oncomplete=function(l){a.complete(c,[c,l])};d(a,c);o(a,c)}var m={NONE:0,NATIVE:1,MICROSOFT:2,MOZILLA:3,GOOGLE:4,MICROSOFTPROTOTYPE:5,SHIM:6},s={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"}, x=function(){if("undefined"===a)return m.NONE;if(a.indexedDB)return linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Native implementation",a.indexedDB),m.NATIVE;if(a.mozIndexedDB)return a.indexedDB=a.mozIndexedDB,"number"===typeof a.IDBTransaction.READ_ONLY&&("number"===typeof a.IDBTransaction.READ_WRITE&&"number"===typeof a.IDBTransaction.VERSION_CHANGE)&&(s.READ_ONLY=a.IDBTransaction.READ_ONLY,s.READ_WRITE=a.IDBTransaction.READ_WRITE,s.VERSION_CHANGE= a.IDBTransaction.VERSION_CHANGE),linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"FireFox Initialized",a.indexedDB),m.MOZILLA;if(a.webkitIndexedDB)return a.indexedDB||(a.indexedDB=a.webkitIndexedDB),a.IDBCursor||(a.IDBCursor=a.webkitIDBCursor),a.IDBDatabase||(a.IDBDatabase=a.webkitIDBDatabase),a.IDBDatabaseException||(a.IDBDatabaseException=a.webkitIDBDatabaseException),a.IDBFactory||(a.IDBFactory=a.webkitIDBFactory),a.IDBIndex||(a.IDBIndex=a.webkitIDBIndex), a.IDBKeyRange||(a.IDBKeyRange=a.webkitIDBKeyRange),a.IDBObjectStore||(a.IDBObjectStore=a.webkitIDBObjectStore),a.IDBRequest||(a.IDBRequest=a.webkitIDBRequest),a.IDBTransaction||(a.IDBTransaction=a.webkitIDBTransaction),"number"===typeof a.IDBTransaction.READ_ONLY&&("number"===typeof a.IDBTransaction.READ_WRITE&&"number"===typeof a.IDBTransaction.VERSION_CHANGE)&&(s.READ_ONLY=a.IDBTransaction.READ_ONLY,s.READ_WRITE=a.IDBTransaction.READ_WRITE,s.VERSION_CHANGE=a.IDBTransaction.VERSION_CHANGE),linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Chrome Initialized",a.indexedDB),m.GOOGLE;if(a.msIndexedDB)return a.indexedDB=a.msIndexedDB,s.READ_ONLY=0,s.READ_WRITE=1,s.VERSION_CHANGE=2,linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"IE10+ Initialized",a.indexedDB),m.MICROSOFT;if("Microsoft Internet Explorer"==navigator.appName){try{a.indexedDB=new ActiveXObject("SQLCE.Factory.4.0"),a.indexedDBSync=new ActiveXObject("SQLCE.FactorySync.4.0")}catch(g){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Initializing IE prototype exception",g)}if(a.JSON)a.indexedDB.json=a.JSON,a.indexedDBSync.json=a.JSON;else{var c={parse:function(a){if("[]"===a)return[];if("{}"===a)return{};throw{message:"Unrecognized JSON to parse: "+a};}};a.indexedDB.json=c;a.indexedDBSync.json=c}a.IDBDatabaseException={UNKNOWN_ERR:0,NON_TRANSIENT_ERR:1,NOT_FOUND_ERR:2,CONSTRAINT_ERR:3,DATA_ERR:4,NOT_ALLOWED_ERR:5,SERIAL_ERR:11,RECOVERABLE_ERR:21,TRANSIENT_ERR:31,TIMEOUT_ERR:32,DEADLOCK_ERR:33};a.IDBKeyRange={SINGLE:0,LEFT_OPEN:1, RIGHT_OPEN:2,LEFT_BOUND:4,RIGHT_BOUND:8};a.IDBRequest={INITIAL:0,LOADING:1,DONE:2};a.IDBTransaction={READ_ONLY:0,READ_WRITE:1,VERSION_CHANGE:2};s.READ_ONLY=0;s.READ_WRITE=1;s.VERSION_CHANGE=2;a.IDBKeyRange.only=function(c){return a.indexedDB.range.only(c)};a.IDBKeyRange.leftBound=function(c,g){return a.indexedDB.range.lowerBound(c,g)};a.IDBKeyRange.rightBound=function(c,g){return a.indexedDB.range.upperBound(c,g)};a.IDBKeyRange.bound=function(c,g,b,d){return a.indexedDB.range.bound(c,g,b,d)};a.IDBKeyRange.lowerBound= function(c,g){return a.IDBKeyRange.leftBound(c,g)};return m.MICROSOFTPROTOTYPE}if(a.shimIndexedDB)return a.indexedDB=a.shimIndexedDB,m.SHIM;linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Your browser doesn't support indexedDB.");return m.NONE}(),n={IDBRequest:function(a){return b(j,a)},IDBBlockedRequest:function(a){return b(p,a)},IDBOpenDBRequest:function(a){return b(v,a)},IDBDatabase:function(a){return b(t,a)},IDBTransaction:function(a){return b(u, a)},IDBCursorRequest:function(a){return b(q,a)}};i.prototype={constructor:i,addListener:function(a,c){linq2indexedDB.prototype.utilities.isArray(a)||(a=[a]);for(var b=0;b<a.length;b++)"undefined"==typeof this._listeners[a[b]]&&(this._listeners[a[b]]=[]),this._listeners[a[b]].push(c)},fire:function(a){"string"==typeof a&&(a={type:a});a.target||(a.target=this);if(!a.type)throw Error("Event object missing 'type' property.");if(this._listeners[a.type]instanceof Array)for(var c=this._listeners[a.type], b=0,e=c.length;b<e;b++)c[b].call(this,a)},removeListener:function(a,c){linq2indexedDB.prototype.utilities.isArray(a)||(a=[a]);for(var b=0;b<a[b].length;b++)if(this._listeners[a[b]]instanceof Array)for(var e=this._listeners[a[b]],h=0,d=e.length;h<d;h++)if(e[h]===c){e.splice(h,1);break}}};var r={objectStoreCreated:"Object store created",objectStoreRemoved:"Object store removed",indexCreated:"Index created",indexRemoved:"Index removed",databaseRemoved:"Database removed",databaseBlocked:"Database blocked", databaseUpgrade:"Database upgrade",databaseOpened:"Database opened"},z={dataInserted:"Data inserted",dataUpdated:"Data updated",dataRemoved:"Data removed",objectStoreCleared:"Object store cleared"},y=!1,k={db:function(g,c,b){try{var e,c=c?c:"Default";b?(linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"db opening",c,b),e=n.IDBOpenDBRequest(a.indexedDB.open(c,b))):(linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "db opening",c),e=n.IDBOpenDBRequest(a.indexedDB.open(c)));e.then(function(a){var h=a[0],d=a[1];n.IDBDatabase(h).then(function(){},function(){linq2indexedDB.prototype.core.closeDatabaseConnection(h)},function(a){(a=a[1])&&a.type==="versionchange"&&a.version!=h.version&&linq2indexedDB.prototype.core.closeDatabaseConnection(h)});var f=k.getDatabaseVersion(h);if(f<b||b==-1||f==""){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"DB Promise upgradeneeded", this,h,d,h.connectionId);k.changeDatabaseStructure(h,b||1).then(function(a){var h=a[0],a=a[1],d=e;d.transaction=h;var i={type:"upgradeneeded"};i.newVersion=b;i.oldVersion=f;i.originalEvent=a;linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseUpgrade,data:i});g.progress(d,[h,i]);n.IDBTransaction(h).then(function(){linq2indexedDB.prototype.core.closeDatabaseConnection(h.db);linq2indexedDB.prototype.core.db(c).then(function(a){g.complete(this,a)},function(a){g.error(this,a)},function(a){g.progress(this, a)})},function(a){g.error(this,a)})},function(a){g.error(this,a)},function(c){linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseBlocked,data:a});g.progress(this,c)})}else if(b&&b<f){linq2indexedDB.prototype.core.closeDatabaseConnection(h);g.error(this,"Versionerror: database is opened in a lower version.")}else{linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseOpened,data:h});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "DB Promise resolved",h,d);g.complete(this,[h,d])}},function(a){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"DB Promise rejected",a[0],a[1]);g.error(this,a)},function(a){a[1].type=="blocked"?linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseBlocked,data:a}):a[1].type=="upgradeneeded"&&linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseUpgrade,data:a});g.progress(this,a)})}catch(h){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception, "DB exception",this,h.message,h),g.error(this,[h.message,h])}},transaction:function(a,c,b,e,h){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Transaction promise started",c,b,e);linq2indexedDB.prototype.utilities.isArray(b)||(b=[b]);e=e||linq2indexedDB.prototype.core.transactionTypes.READ_ONLY;try{for(var d=[],f=0;f<b.length;f++)(!c.objectStoreNames||!c.objectStoreNames.contains(b[f]))&&d.push(b[f]);if(0<d.length&&h)setTimeout(function(){y=!0;var h= k.getDatabaseVersion(c)+1,f=c.name;linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Transaction database upgrade needed: ",c);linq2indexedDB.prototype.core.closeDatabaseConnection(c);linq2indexedDB.prototype.core.db(f,h).then(function(c){y=!1;var h=c[0].transaction(b,e);n.IDBTransaction(h).then(function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Transaction completed.",h);a.complete(this,c)},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error, "Transaction error/abort.",c);a.error(this,c)});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Transaction created.",h);a.progress(h,[h])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Transaction error.",c);a.error(this,c)},function(a){if("upgradeneeded"==a[1].type)for(var c=0;c<d.length;c++)linq2indexedDB.prototype.core.createObjectStore(a[0],d[c],{keyPath:"Id",autoIncrement:!0})})},y?10:1); else{var i=c.transaction(b,e);n.IDBTransaction(i).then(function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Transaction completed.",c);a.complete(this,c)},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Transaction error/abort.",c);a.error(this,c)});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Transaction transaction created.",i);a.progress(i, [i])}}catch(j){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"Transaction exception",j,c),j.type="exception",a.error(this,[j.message,j])}},changeDatabaseStructure:function(a,c){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"changeDatabaseStructure started",a,c);n.IDBBlockedRequest(a.setVersion(c)).then(function(a){b.complete(this,a)}, function(a){b.error(this,a)},function(a){b.progress(this,a)})})},objectStore:function(a,c,b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"objectStore started",c,b);try{var e=c.objectStore(b);linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"objectStore completed",c,e);a.complete(e,[c,e])}catch(h){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"objectStore exception", h,c),linq2indexedDB.prototype.core.abortTransaction(c),a.error(this,[h.message,h])}},createObjectStore:function(a,c,b,e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"createObjectStore started",c,b,e);try{if(c.db.objectStoreNames.contains(b))linq2indexedDB.prototype.core.objectStore(c,b).then(function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"ObjectStore Found",c[1],b);linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "createObjectStore Promise",c[0],c[1]);a.complete(d,c)},function(c){a.error(this,c)});else{var h={};e?(e.keyPath&&(h.keyPath=e.keyPath),h.autoIncrement=e.autoIncrement):h.autoIncrement=!0;var d=c.db.createObjectStore(b,h,h.autoIncrement);linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"ObjectStore Created",c,d);linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.objectStoreCreated,data:d});a.complete(d,[c,d])}}catch(f){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception, "createObjectStore Exception",f),linq2indexedDB.prototype.core.abortTransaction(c),a.error(this,[f.message,f])}},deleteObjectStore:function(a,c,b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"deleteObjectStore Promise started",c,b);try{c.db.objectStoreNames.contains(b)?(c.db.deleteObjectStore(b),linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"ObjectStore Deleted",b),linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "deleteObjectStore completed",b),linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.objectStoreRemoved,data:b}),a.complete(this,[c,b])):(linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"ObjectStore Not Found",b),a.error(this,["ObjectStore Not Found"+b]))}catch(e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"deleteObjectStore exception",e),linq2indexedDB.prototype.core.abortTransaction(c),a.error(this, [e.message,e])}},index:function(a,c,b,e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Index started",c,b,e);try{var h=b;-1==b.indexOf(linq2indexedDB.prototype.core.indexSuffix)&&(h+=linq2indexedDB.prototype.core.indexSuffix);if(!c.indexNames.contains(h)&&e)setTimeout(function(){y=!0;var h=k.getDatabaseVersion(c.transaction.db)+1,d=c.transaction.db.name,f=c.transaction.mode,i=[c.name],j=c.name;linq2indexedDB.prototype.core.closeDatabaseConnection(c.transaction.db); linq2indexedDB.prototype.core.db(d,h).then(function(c){y=!1;linq2indexedDB.prototype.core.transaction(c[0],i,f,e).then(function(){},function(c){a.error(this,c)},function(c){linq2indexedDB.prototype.core.index(linq2indexedDB.prototype.core.objectStore(c[0],j),b).then(function(c){a.complete(this,c)},function(c){a.error(this,c)})})},function(c){a.error(this,c)},function(e){var h=e[0];"upgradeneeded"==e[1].type&&linq2indexedDB.prototype.core.createIndex(linq2indexedDB.prototype.core.objectStore(h,c.name), b).then(function(){},function(c){a.error(this,c)})})},y?10:1);else{var d=c.index(h);linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Index completed",c.transaction,d,c);a.complete(this,[c.transaction,d,c])}}catch(f){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"Exception index",f),linq2indexedDB.prototype.core.abortTransaction(c.transaction),a.error(this,[f.message,f])}},createIndex:function(a,c,b,e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "createIndex started",c,b,e);try{var h=b;-1==b.indexOf(linq2indexedDB.prototype.core.indexSuffix)&&(h+=linq2indexedDB.prototype.core.indexSuffix);if(c.indexNames.contains(h))linq2indexedDB.prototype.core.index(c,b,!1).then(function(c){a.complete(this,c)});else{var d=c.createIndex(h,b,{unique:e?e.unique:!1,multiRow:e?e.multiEntry:!1,multiEntry:e?e.multiEntry:!1});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"createIndex completed",c.transaction,d,c); linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.indexCreated,data:d});a.complete(this,[c.transaction,d,c])}}catch(f){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"createIndex Failed",f),linq2indexedDB.prototype.core.abortTransaction(c.transaction),a.error(this,[f.message,f])}},deleteIndex:function(a,c,b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"deleteIndex started",c,b);try{var e=b; -1==b.indexOf(linq2indexedDB.prototype.core.indexSuffix)&&(e+=linq2indexedDB.prototype.core.indexSuffix);c.deleteIndex(e);linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.indexRemoved,data:e});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"deleteIndex completed",c.transaction,b,c);a.complete(this,[c.transaction,b,c])}catch(h){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"deleteIndex Failed", h),linq2indexedDB.prototype.core.abortTransaction(c.transaction),a.error(this,[h.message,h])}},cursor:function(a,c,b,e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Cursor Promise Started",c);try{var h=[];b||(b=IDBKeyRange.lowerBound(0));(e?n.IDBCursorRequest(c.openCursor(b,e)):b?n.IDBCursorRequest(c.openCursor(b)):n.IDBCursorRequest(c.openCursor())).then(function(b){var b=b[1],e=c.transaction||c.objectStore.transaction;linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Cursor completed",h,e,b);a.complete(this,[h,e,b])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Cursor error",c);a.error(this,c)},function(c){var b=c[0],c=c[1];linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Cursor progress",b,c);b.value&&(a.progress(this,[b.value,b,c]),h.push(b.value));b["continue"]()})}catch(d){e=c.transaction||c.objectStore.transaction,linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception, "Exception cursor",d),linq2indexedDB.prototype.core.abortTransaction(e),a.error(this,[d.message,d])}},keyCursor:function(a,c,b,e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"keyCursor Started",c,b,e);var h=[];try{b||(b=IDBKeyRange.lowerBound(0)),(e?n.IDBCursorRequest(source.openKeyCursor(b,e)):n.IDBCursorRequest(source.openKeyCursor(b))).then(function(b){b=b[1];linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "keyCursor completed",h,c.objectStore.transaction,b);a.complete(this,[h,c.objectStore.transaction,b])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"keyCursor error",c);a.error(this,c)},function(b){var e=b[0],b=b[1];linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"keyCursor progress",e,b);e.value&&(a.progress(this,[e.value,b,c.objectStore.transaction]),h.push(e.value));e["continue"]()})}catch(d){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception, "Exception keyCursor",d),linq2indexedDB.prototype.core.abortTransaction(c.objectStore.transaction),a.error(this,[d.message,d])}},get:function(a,c,b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Get Started",c);try{n.IDBRequest(c.get(b)).then(function(b){var e=b[0],b=b[1],d=c.transaction||c.objectStore.transaction;linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Get completed",e,d,b);a.complete(this,[e, d,b])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Get error",c);a.error(this,c)})}catch(e){b=c.transaction||c.objectStore.transaction,linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"Exception get",e),linq2indexedDB.prototype.core.abortTransaction(b),a.error(this,[e.message,e])}},getKey:function(a,c,b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "GetKey Started",c,b);try{n.IDBRequest(c.getKey(b)).then(function(b){var e=b[0],b=b[1];linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"GetKey completed",e,c.objectStore.transaction,b);a.complete(this,[e,c.objectStore.transaction,b])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"GetKey error",c);a.error(this,c)})}catch(e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception, "Exception getKey",e),linq2indexedDB.prototype.core.abortTransaction(c.objectStore.transaction),a.error(this,[e.message,e])}},insert:function(a,c,b,e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Insert Started",c,b,e);try{(e?n.IDBRequest(c.add(b,e)):n.IDBRequest(c.add(b))).then(function(e){var d=e[0],e=e[1];c.keyPath&&(b[c.keyPath]=d);linq2indexedDB.prototype.core.dbDataChanged.fire({type:z.dataInserted,data:b,objectStore:c});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Insert completed",b,d,c.transaction,e);a.complete(this,[b,d,c.transaction,e])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Insert error",c);a.error(this,c)})}catch(d){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"Insert exception",d),linq2indexedDB.prototype.core.abortTransaction(c.transaction),a.error(this,[d.message,d])}},update:function(a,c,b,e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Update Started",c,b,e);try{(e?n.IDBRequest(c.put(b,e)):n.IDBRequest(c.put(b))).then(function(e){var d=e[0],e=e[1];linq2indexedDB.prototype.core.dbDataChanged.fire({type:z.dataUpdated,data:b,objectStore:c});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Update completed",b,d,c.transaction,e);a.complete(this,[b,d,c.transaction,e])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Update error",c); a.error(this,c)})}catch(d){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"Update exception",d),linq2indexedDB.prototype.core.abortTransaction(c.transaction),a.error(this,[d.message,d])}},remove:function(a,c,b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Remove Started",c,b);try{n.IDBRequest(c["delete"](b)).then(function(e){var d=e[0],e=e[1];linq2indexedDB.prototype.core.dbDataChanged.fire({type:z.dataRemoved, data:b,objectStore:c});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Remove completed",d,c.transaction,e);a.complete(this,[d,c.transaction,e])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Remove error",c);a.error(this,c)})}catch(e){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"Remove exception",e),linq2indexedDB.prototype.core.abortTransaction(c.transaction), a.error(this,[e.message,e])}},clear:function(a,c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Clear Started",c);try{n.IDBRequest(c.clear()).then(function(b){var d=b[0],b=b[1];linq2indexedDB.prototype.core.dbDataChanged.fire({type:z.objectStoreCleared,objectStore:c});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Clear completed",d,c.transaction,b);a.complete(this,[d,c.transaction,b])},function(c){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error, "Clear error",c);a.error(this,c)})}catch(b){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception,"Clear exception",b),linq2indexedDB.prototype.core.abortTransaction(c.transaction),a.error(this,[b.message,b])}},deleteDb:function(b,c){try{"undefined"!=typeof a.indexedDB.deleteDatabase?n.IDBBlockedRequest(a.indexedDB.deleteDatabase(c)).then(function(a){var d=a[0],a=a[1];linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseRemoved});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Delete Database Promise completed",d,a,c);b.complete(this,[d,a,c])},function(a){var d=a[0],a=a[1];a.currentTarget&&6==a.currentTarget.errorCode?(linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseRemoved}),b.complete(this,[d,a,c])):x==m.SHIM&&"Database does not exist"==a.message?(linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseRemoved}),b.complete(this,[d,a,c])):(linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Delete Database Promise error", d,a),b.error(this,[d,a]))},function(a){"blocked"==a[0]&&linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseBlocked});linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Delete Database Promise blocked",a);b.progress(this,a)}):(linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Delete Database function not found",c),linq2indexedDB.prototype.core.db(c,-1).then(function(a){var d=a[0],a=a[1];linq2indexedDB.prototype.core.dbStructureChanged.fire({type:r.databaseRemoved}); b.complete(this,[d,a,c])},function(a){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.error,"Clear Promise error",a);b.error(this,a)},function(a){var c=a[0];if("upgradeneeded"==a[1].type){for(a=0;a<c.objectStoreNames.length;a++)linq2indexedDB.prototype.core.deleteObjectStore(c.txn,c.objectStoreNames[a]);linq2indexedDB.prototype.core.closeDatabaseConnection(c)}}))}catch(d){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.exception, "Delete Database Promise exception",d),b.error(this,[d.message,d])}},getDatabaseVersion:function(a){a=parseInt(a.version);return isNaN(a)||0>a?0:a},indexOf:function(a,c,b){for(var e=0;e<a.length;e++)if(a[e][b]==c[b])return e;return-1}};linq2indexedDB.prototype.core={db:function(a,c){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){k.db(b,a,c)})},transaction:function(a,c,b,e){return linq2indexedDB.prototype.utilities.promiseWrapper(function(d){a.then?a.then(function(a){f?setTimeout(function(){k.transaction(d, a[0],c,b,e)},1):k.transaction(d,a[0],c,b,e)},function(a){d.error(this,a)},function(a){d.progress(this,a)}):f?setTimeout(function(){k.transaction(d,a,c,b,e)},1):k.transaction(d,a,c,b,e)})},objectStore:function(a,c){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){a.then?a.then(function(){},function(a){b.error(this,a)},function(a){k.objectStore(b,a[0],c)}):k.objectStore(b,a,c)})},createObjectStore:function(a,c,b){return linq2indexedDB.prototype.utilities.promiseWrapper(function(e){a.then? a.then(function(){},function(a){e.error(this,a)},function(a){k.createObjectStore(e,a[0],c,b)}):k.createObjectStore(e,a,c,b)})},deleteObjectStore:function(a,c){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){a.then?a.then(function(){},function(a){b.error(this,a)},function(a){k.deleteObjectStore(b,a[0],c)}):k.deleteObjectStore(b,a,c)})},index:function(a,c,b){return linq2indexedDB.prototype.utilities.promiseWrapper(function(e){a.then?a.then(function(a){k.index(e,a[1],c,b)},function(a){e.error(this, a)}):k.index(e,a,c,b)})},createIndex:function(a,c,b){return linq2indexedDB.prototype.utilities.promiseWrapper(function(e){a.then?a.then(function(a){k.createIndex(e,a[1],c,b)},function(a){e.error(this,a)}):k.createIndex(e,a,c,b)})},deleteIndex:function(a,c){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){a.then?a.then(function(a){k.deleteIndex(b,a[1],c)},function(a){b.error(this,a)}):k.deleteIndex(b,a,c)})},cursor:function(a,c,b){return linq2indexedDB.prototype.utilities.promiseWrapper(function(e){a.then? a.then(function(a){k.cursor(e,a[1],c,b)},function(a){e.error(this,a)}):k.cursor(e,a,c,b)})},keyCursor:function(a,c,b){return linq2indexedDB.prototype.utilities.promiseWrapper(function(e){a.then?a.then(function(a){k.keyCursor(e,a[1],c,b)},function(a){e.error(this,a)}):k.keyCursor(e,a,c,b)})},get:function(a,c){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){a.then?a.then(function(a){k.get(b,a[1],c)},function(a){b.error(this,a)}):k.get(b,a,c)})},getKey:function(a,b){return linq2indexedDB.prototype.utilities.promiseWrapper(function(d){a.then? a.then(function(a){k.getKey(d,a[1],b)},function(a){d.error(this,a)}):k.getKey(d,a,b)})},insert:function(a,b,d){return linq2indexedDB.prototype.utilities.promiseWrapper(function(e){a.then?a.then(function(a){k.insert(e,a[1],b,d)},function(a){e.error(this,a)}):k.insert(e,a,b,d)})},update:function(a,b,d){return linq2indexedDB.prototype.utilities.promiseWrapper(function(e){a.then?a.then(function(a){k.update(e,a[1],b,d)},function(a){e.error(this,a)}):k.update(e,a,b,d)})},remove:function(a,b){return linq2indexedDB.prototype.utilities.promiseWrapper(function(d){a.then? a.then(function(a){k.remove(d,a[1],b)},function(a){d.error(this,a)}):k.remove(d,a,b)})},clear:function(a){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){a.then?a.then(function(a){k.clear(b,a[1])},function(a){b.error(this,a)}):k.clear(b,a)})},deleteDb:function(a){return linq2indexedDB.prototype.utilities.promiseWrapper(function(b){k.deleteDb(b,a)})},closeDatabaseConnection:function(a){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information, "Close database Connection: ",a);a.close()},abortTransaction:function(a){linq2indexedDB.prototype.utilities.log(linq2indexedDB.prototype.utilities.severity.information,"Abort transaction: "+a);x!=m.MICROSOFT&&(a.abort(),linq2indexedDB.prototype.core.closeDatabaseConnection(a.db))},transactionTypes:s,dbStructureChanged:new i,dbDataChanged:new i,databaseEvents:r,dataEvents:z,implementation:x,implementations:m};linq2indexedDB.prototype.core.indexSuffix=x==m.SHIM?"IIndex":"-Index"}(window,"undefined"!== typeof Windows),window.linq2indexedDB=linq2indexedDB,"undefined"!==typeof window.jQuery&&($.linq2indexedDB=linq2indexedDB)):onmessage=function(a){var f=a.data.data,i=a.data.sortClauses||[],a=JSON.parse(a.data.filters||"[]",linq2indexedDB.prototype.utilities.deserialize),f=linq2indexedDB.prototype.utilities.filterSort(f,a,i);postMessage(f)};Array.prototype.contains=function(a){return this.indexOf(a)>-1};